
The 404 error indicates that the /yg_bookings/sessions/ URL is not correctly mapped in your Django project. To resolve this issue, ensure that you have a proper URL configuration and view in place to handle this endpoint. Let's go through the steps to set this up correctly:

Step 1: Define the URL Pattern
In your urls.py, add a URL pattern for the sessions endpoint.

python
Copy code
# urls.py in yg_bookings app

from django.urls import path
from .views import BookingView

urlpatterns = [
    # Other URL patterns
    path('sessions/', BookingView.as_view(), name='sessions'),
]
Step 2: Update the BookingView
Make sure that the BookingView is correctly defined to handle AJAX requests and return session data in JSON format.

python
Copy code
# views.py in yg_bookings app

from django.http import JsonResponse
from django.views.generic import ListView
from .models import Sessions
from datetime import datetime

class BookingView(ListView):
    """ 
    Fetches all available bookings and passes them to the template
    """
    model = Sessions
    template_name = 'yg_bookings/bookings.html'
    context_object_name = 'bookings_available'

    def get(self, request):
        if request.headers.get('x-requested-with') == 'XMLHttpRequest':
            start = request.GET.get('start', None)
            end = request.GET.get('end', None)

            if start and end:
                start_date = datetime.fromisoformat(start)
                end_date = datetime.fromisoformat(end)

                sessions = Sessions.objects.filter(start_time__gte=start_date, end_time__lte=end_date)
                sessions_list = []

                for session in sessions:
                    sessions_list.append({
                        'title': session.title,
                        'start': session.start_time.isoformat(),
                        'end': session.end_time.isoformat(),
                        'description': session.description,
                        'duration': str(session.duration),
                        'location': session.location,
                    })

                return JsonResponse(sessions_list, safe=False)

        return super().get(request)
Step 3: Update the Template JavaScript
Ensure the JavaScript in your template correctly references the sessions URL to fetch the session data.

html
Copy code
{% extends "yg_bookings/base.html" %}
{% load static %}
{% block content %}

<div id="calendar"></div>

<h1>Available Bookings</h1>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/locales-all.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        navLinks: true,  // can click day/week names to navigate views
        editable: false,
        selectable: true,
        nowIndicator: true,
        events: function(fetchInfo, successCallback, failureCallback) {
            $.ajax({
                url: "{% url 'sessions' %}",
                dataType: 'json',
                data: {
                    start: fetchInfo.startStr,
                    end: fetchInfo.endStr,
                },
                success: function(data) {
                    var events = [];
                    $(data).each(function() {
                        events.push({
                            title: this.title,
                            start: this.start,
                            end: this.end,
                            description: this.description,
                            location: this.location,
                        });
                    });
                    successCallback(events);
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching events:', error);
                    failureCallback();
                }
            });
        },
        eventClick: function(info) {
            window.location.href = "{% url 'login' %}";
        }
    });

    calendar.render();
});
</script>

{% endblock %}